# 日中最適化のための統計分析計画

作成日: 2026-01-09

## 1. 目的

grok銘柄での利益最大化を目的とした統計分析基盤の構築。

### 背景
- ショート/ロング切替戦略（曜日×信用区分×価格帯）の延長
- IntradayAnalysisで日中高値安値分析を実装済み
- 次フェーズとして統計的アプローチで端緒を発見し、フロントエンドに反映

### 最終ゴール
- 統計的に有意なパターンの発見
- エントリー/イグジットタイミングの最適化
- フロントエンド（ymnk.jp）への知見反映

---

## 2. 検証項目

### 2.1 日経平均/TOPIXとの相関・連関

**目的**: 個別銘柄が市場全体とどの程度連動するかを把握

**分析内容**:
- 5分足での価格変動率（リターン）の相関係数
- β値（市場感応度）の算出: `銘柄リターン = α + β × 市場リターン + ε`
- 連動性の時間帯別変化（9:00-9:30は高いが後場は低い等）
- 残差分析（市場要因を除いた独自の動き）

**期待される知見**:
- β > 1 の銘柄は市場上昇時にロング有利
- 連動性が低い時間帯はエントリーチャンス

### 2.2 時間的な特徴

**目的**: 時間帯ごとの傾向を把握し、最適なエントリー/イグジット時間を特定

**分析内容**:

#### A. 時間帯別騰落率（30分刻み）
| 時間帯 | 対象 |
|--------|------|
| 09:00-09:30 | 寄付き直後 |
| 09:30-10:00 | 前場前半 |
| 10:00-10:30 | 前場中盤 |
| 10:30-11:00 | 前場後半 |
| 11:00-11:30 | 前場終盤 |
| 12:30-13:00 | 後場寄り |
| 13:00-13:30 | 後場前半 |
| 13:30-14:00 | 後場中盤 |
| 14:00-14:30 | 後場後半 |
| 14:30-15:00 | 後場終盤 |
| 15:00-15:30 | 大引け |

#### B. 高値・安値の出現時間分布
- 日中高値が出現する時間帯の頻度分布
- 日中安値が出現する時間帯の頻度分布
- 前場/後場での傾向差

**期待される知見**:
- 「9:30までに安値、14:00以降に高値」等のパターン
- 曜日別の時間パターンの違い

### 2.3 市場区分・業種別特徴

**目的**: 属性ごとの日中パターンの違いを把握

**分析内容**:
- **市場区分別**: プライム / スタンダード / グロース
- **業種別**: 33業種（東証分類）
- **分析指標**:
  - 平均日中ボラティリティ
  - 高値安値の出現パターン
  - 日経/TOPIXとの相関

**期待される知見**:
- グロース市場は後場に動きやすい等
- 業種による寄付き/引けの傾向差

### 2.4 銘柄カテゴリ別特徴

**目的**: grok銘柄と他カテゴリの違いを明確化

**対象カテゴリ**:
| カテゴリ | データソース | 特徴 |
|----------|--------------|------|
| grok銘柄 | grok_trending.parquet | AI選定の注目銘柄 |
| 政策銘柄 | meta.parquet (tags: 2026テーマ等) | 政策関連テーマ |
| TOPIX Core30 | meta.parquet (categories) | 超大型株 |
| 高市銘柄 | meta.parquet (categories) | 出来高上位 |

**分析内容**:
- 各カテゴリの日中パターン比較
- ボラティリティ特性
- 最適エントリー/イグジット時間の差異

**期待される知見**:
- grok銘柄は寄付き後30分が勝負等
- カテゴリ別の最適戦略

---

## 3. データソース

| ファイル | 内容 | 用途 |
|----------|------|------|
| prices_60d_5m.parquet | 5分足価格（60日） | 個別銘柄の日中分析 |
| index_prices_60d_5m.parquet | 日経/TOPIX 5分足 | 相関分析 |
| grok_trending.parquet | grok選定銘柄 | カテゴリ分析 |
| meta.parquet | 銘柄メタ（業種、市場、tags） | 属性別分析 |
| meta_jquants.parquet | J-Quants銘柄マスタ | 補完用 |

---

## 4. 分析手法

### 統計手法
- **相関分析**: ピアソン相関係数、スピアマン順位相関
- **回帰分析**: OLS回帰によるβ値算出
- **分布分析**: ヒストグラム、カーネル密度推定
- **検定**: t検定、χ²検定（有意性確認）

### 可視化
- Plotly（インタラクティブHTML）
- ヒートマップ（時間×曜日）
- 箱ひげ図（カテゴリ比較）
- 折れ線グラフ（時系列）

---

## 5. ディレクトリ構成

```
improvement/
  intraday_analysis/
    01_correlation_analysis.py    # 検証2.1: 相関分析
    02_time_pattern_analysis.py   # 検証2.2: 時間特徴
    03_market_segment_analysis.py # 検証2.3: 市場区分
    04_category_comparison.py     # 検証2.4: カテゴリ比較
    utils.py                      # 共通関数

output/
  intraday_analysis/
    correlation_report.html
    time_pattern_report.html
    market_segment_report.html
    category_comparison_report.html
```

---

## 6. 実装スケジュール

| Step | 内容 | 成果物 |
|------|------|--------|
| 1 | 方針ドキュメント作成 | 本ファイル |
| 2 | 分析基盤構築（utils.py） | 共通関数 |
| 3 | 相関分析 | correlation_report.html |
| 4 | 時間特徴分析 | time_pattern_report.html |
| 5 | 市場区分分析 | market_segment_report.html |
| 6 | カテゴリ比較 | category_comparison_report.html |
| 7 | フロントエンド統合検討 | IntradayAnalysis改善案 |

---

## 7. 成功指標

- 統計的に有意なパターンを3つ以上発見
- grok銘柄での勝率向上に寄与する知見
- フロントエンドへの具体的な改善提案

---

## 8. 備考

- 既存のimprovement/は別アプローチのため参照不要
- メインターゲット: grok銘柄での利益最大化
- 分析結果は随時このドキュメントに追記
