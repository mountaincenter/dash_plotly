# セッション引き継ぎ: IFO戦略シミュレーション
**日時**: 2025-12-02 10:40 JST

---

## 1. 現在の作業状況

### 完了タスク
1. 9時詳細テーブルに取引制限銘柄（margin_code=3）表示を追加
2. 寄天（寄付き=高値）パターンを順番分類に追加
3. IFO戦略（寄付買い → -1円損切り / +X%利確）のシミュレーション実行

### 中断箇所
- 利確ライン最適化のシミュレーション結果を確認した直後
- ショートロジックの議論開始前

---

## 2. 9時詳細パターン分類（制限除外後 234件）

| 順番 | 件数 | 割合 | 説明 |
|------|------|------|------|
| 高値先↓ | 72 | 30.8% | 高値→安値の順（途中で下落） |
| 寄天↓ | 41 | 17.5% | 寄付き=高値（即下落） |
| 寄底↑ | 30 | 12.8% | 寄付き=安値（即上昇） |
| 安値先↑ | 55 | 23.5% | 安値→高値の順（途中で上昇） |
| 同時 | 36 | 15.4% | 高値安値が同時刻 |

**ポイント**:
- 下落パターン（高値先+寄天）: 48.3%
- 上昇パターン（寄底+安値先）: 36.3%
- 事前予測は困難 → リスク管理で対応

---

## 3. IFO戦略シミュレーション結果

### 戦略概要
- **エントリー**: 寄付き買い（IFO注文）
- **損切り**: 寄付き - 1円（固定 -100円/100株）
- **利確**: 寄付き + X%

### ロング結果（234件）

| 利確% | 利確 | 損切 | TO | 勝率 | 平均 | 合計 |
|-------|------|------|-----|------|------|------|
| 0.3% | 69 | 152 | 13 | 29.5% | +93円 | +21,688円 |
| 0.4% | 65 | 154 | 15 | 28.6% | +142円 | +33,166円 |
| 0.5% | 65 | 154 | 15 | 28.6% | +199円 | +46,507円 |
| 0.6% | 63 | 156 | 15 | 27.8% | +254円 | +59,322円 |
| 0.7% | 61 | 156 | 17 | 27.8% | +309円 | +72,241円 |
| 0.8% | 56 | 157 | 21 | 27.4% | +354円 | +82,801円 |
| 0.9% | 54 | 158 | 22 | 26.9% | +396円 | +92,620円 |
| **1.0%** | 54 | 158 | 22 | 26.9% | **+448円** | **+104,811円** |
| 1.2% | 51 | 159 | 24 | 26.1% | +548円 | +128,296円 |
| 1.5% | 44 | 161 | 29 | 25.2% | +647円 | +151,314円 |
| 2.0% | 37 | 162 | 35 | 24.8% | +779円 | +182,402円 |

### ショート結果（234件）

| 利確% | 利確 | 損切 | TO | 勝率 | 平均 | 合計 |
|-------|------|------|-----|------|------|------|
| 0.3% | 96 | 124 | 14 | 43.6% | +266円 | +62,261円 |
| 0.4% | 90 | 127 | 17 | 41.9% | +349円 | +81,737円 |
| 0.5% | 89 | 127 | 18 | 41.9% | +442円 | +103,407円 |
| 0.6% | 87 | 128 | 19 | 41.5% | +531円 | +124,219円 |
| 0.7% | 86 | 128 | 20 | 41.0% | +621円 | +145,429円 |
| 0.8% | 84 | 129 | 21 | 40.6% | +697円 | +163,008円 |
| 0.9% | 79 | 132 | 23 | 39.3% | +742円 | +173,674円 |
| **1.0%** | 77 | 133 | 24 | 38.5% | **+787円** | **+184,079円** |
| 1.2% | 67 | 134 | 33 | 37.2% | +932円 | +218,179円 |
| 1.5% | 61 | 135 | 38 | 36.8% | +1,122円 | +262,488円 |
| 2.0% | 51 | 138 | 45 | 35.5% | +1,338円 | +313,055円 |

### 重要な発見
1. **ショートの方が優秀**: 同じ利確%でもショートの方が勝率・合計ともに上
2. **利確%を上げるほど合計増**: ただし勝率は下がる（トレードオフ）
3. **損切り固定の威力**: 勝率30%以下でもトータルプラス

---

## 4. 順番別の戦略適性（0.5%利確時）

| 順番 | ロング | ショート | 推奨 |
|------|--------|----------|------|
| 寄底 | 100%勝ち | 100%負け | ロング |
| 寄天 | 100%負け | 100%勝ち | ショート |
| 高値先 | 微益 | - | 要検討 |
| 安値先 | 微益 | - | 要検討 |

**課題**: 寄底/寄天は事後にしか判定できない

---

## 5. 戦略構想（ユーザーの方針）

### デイトレ戦略
```
23時: Grok銘柄選定
     ↓
翌朝: IFO注文（買い + 利確X% + 損切-1円）
     ↓
9-10時: チャート監視、必要なら手動決済
```

### スイング戦略（v3.0併用）
- 買い5: 5日保有、勝率58%、平均+52,118円
- 売り5: 5日保有、勝率78%、平均+13,178円

### スケール方針
- 100株から開始
- 勝率・期待値が安定したら枚数増

---

## 6. 未解決の論点

1. **利確ラインの最適値**
   - 0.5%? 1.0%? 1.5%?
   - 株価帯によって変えるべきか？

2. **ショートロジックの実装**
   - IFO売り注文の発注方法
   - 空売り可能銘柄の絞り込み

3. **ロング/ショートの使い分け**
   - 全銘柄ショート？
   - シグナル（買い/売り）に応じて切り替え？

---

## 7. 関連ファイル

### データ
- `improvement/data/grok_9am_detail.parquet` - 9時詳細（238件、is_restricted列あり）
- `improvement/data/grok_trending.parquet` - 当日選定銘柄
- `improvement/data/grok_trending_archive.parquet` - 過去選定銘柄
- `improvement/data/margin_code_master.parquet` - 取引制限情報
- `improvement/yfinance/data/prices_60d_5m.parquet` - 5分足データ

### スクリプト
- `improvement/scripts/generate_swing_analysis_html.py` - HTML生成（9時詳細テーブル含む）

### 出力
- `improvement/output/grok_swing_analysis_light.html` - 分析レポート

---

## 8. 次のアクション

1. **利確ラインの決定**: 1.0%を暫定採用？（バランス良い）
2. **ショート戦略の詳細設計**: シグナルとの連携
3. **IFO注文の自動化検討**: 23時選定 → 自動発注

---

## 9. シミュレーション再実行コマンド

```python
# improvement/scripts/orb_vwap_backtest.py にロジック追加予定
# 現在はインラインで実行

python3 << 'EOF'
import pandas as pd
from pathlib import Path

DATA_DIR = Path("improvement/data")
YFINANCE_DIR = Path("improvement/yfinance/data")

detail = pd.read_parquet(DATA_DIR / "grok_9am_detail.parquet")
detail = detail[~detail['is_restricted']]

prices_5m = pd.read_parquet(YFINANCE_DIR / "prices_60d_5m.parquet")
prices_5m['date'] = prices_5m['Datetime'].dt.date

# simulate() / simulate_short() 関数でバックテスト
# 詳細は本セッションのログ参照
EOF
```

---

**作成者**: Claude Code
**引き継ぎ用**: `brew upgrade claude-code` 後に本ドキュメントを参照
