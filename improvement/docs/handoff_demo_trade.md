# デモトレード機能 実装引き継ぎ

## 背景

高値崩れ常習犯リストを活用したショート戦略の訓練ツール。
バックテストは「戦略が有効か」を検証するが、デモトレードは「その戦略を実行できるか」を訓練する。

## 目的

- 先が見えない状態でチャートを再生し、エントリー/イグジット判断を訓練
- 高値崩れパターンだけでなく、失敗しそうなチャートも訓練対象
- 寄付買い大引け売りなど、シンプルな戦略の訓練にも使用可能

## 要件

### Phase 1: チャート基盤 + アニメーション
- 5分足ローソク足チャート
- アニメーション再生（1x, 5x, 10x速度切替）
- 再生/一時停止/リセット
- 先が見えないモード（デフォルト）/ 全体表示モード

### Phase 2: インジケーター追加
- RSI（14期間）
- 出来高バー
- 3段表示（株価 / RSI / 出来高）

### Phase 3: 売買機能
- エントリーボタン（ショート/ロング）
- イグジットボタン
- ポジション表示
- 損益計算・表示
- 取引履歴

### Phase 4: パターン認識補助
- ピーク/ボトムの自動検出・表示（オプション表示）
- 高値崩れ発生ポイントのマーカー

### Phase 5: 銘柄選択
- 銘柄ドロップダウン
- 日付選択
- パターン種別フィルタ（高値崩れ常習犯 / ランダム / 失敗パターン）

## データソース

```
improvement/data/surge_candidates_5m.parquet
```

カラム:
- ticker: 銘柄コード (例: 4425.T)
- Datetime: タイムスタンプ
- Open, High, Low, Close: OHLC
- Volume: 出来高

約2,154銘柄、60日分の5分足データ。

## 参考ファイル

### 既存HTMLスタイル
```
improvement/output/short_candidates_tomorrow.html
```
- ダークテーマ
- CSS変数: --bg-primary: #0d1117, --accent-red: #f85149 等

### 戦略ドキュメント
```
improvement/docs/short_strategy.md
```
- 高値崩れ常習犯の定義
- エントリー/イグジット条件

### 常習犯リスト
```
improvement/data/morning_peak_watchlist.parquet
```
- 496銘柄（高値崩れ3回以上）
- am_high_ratio: 前場高値率
- avg_crash_pct: 平均崩れ幅

## 出力先

```
improvement/output/demo_trade.html
```

## 技術選定

- チャートライブラリ: Plotly.js（既存プロジェクトで使用）または lightweight-charts
- アニメーション: JavaScript setInterval / requestAnimationFrame
- データ埋め込み: JSON形式でHTML内に埋め込み

## 実装の注意点

1. **パフォーマンス**: 60日分の5分足は大量データ。1日分ずつ読み込む設計を推奨
2. **先が見えないモード**: currentIndex までのデータのみ表示
3. **RSI計算**: フロントエンドでリアルタイム計算、または事前計算してJSON埋め込み

## 起動コマンド（新セッション用）

```
このファイルを読んでデモトレード機能を実装してください。
Phase 1から順に進めてください。
```
