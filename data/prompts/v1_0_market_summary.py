"""
Grok Prompt v1.0 - Market Summary
市場サマリーレポート生成プロンプト

Created: 2025-10-31
Description:
    - 東証大引け後（15:30終了）に16時配信向け市場サマリーを生成
    - 1次情報（東証公式、TDnet）を基軸に2次情報で補完
    - 日経平均、TOPIX、各市場区分指数を網羅
    - 1000-1500字の詳細レポート（2-3分読み切り可能）
"""

from typing import Any


def build_market_summary_prompt(context: dict[str, str]) -> str:
    """
    国内株式市場サマリーレポート生成用のGrokプロンプトを構築

    Args:
        context: 実行日・最新営業日などのコンテキスト情報
            - execution_date: 実行日（YYYY-MM-DD形式）
            - latest_trading_day: 最新営業日（YYYY-MM-DD形式）
            - report_time: レポート配信時刻（例: "16:00"）

    Returns:
        str: Grok APIに送信するプロンプト
    """
    execution_date = context.get('execution_date', '2025-10-31')
    latest_trading_day = context.get('latest_trading_day', '2025-10-31')
    report_time = context.get('report_time', '16:00')

    return f"""あなたは経験豊富な日本株アナリストです。{latest_trading_day}（金）の東証市場大引け後（15:30終了）時点で、{report_time}配信向けの市場サマリーレポートを作成してください。文字数は1000-1500字（詳細を追加しつつ、2-3分読み切り可能に読みやすく）。

## コンテキスト
- 焦点: 東証プライム、スタンダード、グロース市場の終値ベース。日経平均、TOPIXを中心に、各市場区分の指数をカバー。
- 情報源優先: 1次情報（東証公式jpx.co.jp、TDnet企業IR発表）を基軸に、2次情報（日経新聞、Bloomberg、Reuters、Yahoo!ファイナンスの高精度記事）で検証・補完。低精度ソース（SNS、匿名ブログなど）は使用せず、矛盾時は1次を優先。クロス検証を徹底し、数値差異時は「※複数ソース確認済」と明記。必要に応じてWeb検索/Browse Pageツールで最新公式データを取得し、リアルタイム性を確保。

## タスク
1. **主要指数**: 日経平均、TOPIX、プライム指数（TOPIX-Prime）、スタンダード指数（TOPIX-Standard）、グロース指数（TOPIX-Growth）の終値、前日比（%表示）、出来高、売買代金。テーブルで統合し、出典URLをテーブル下に記載。全体市場の1文概要（例: 「前場高後場調整」）を追加。

2. **セクター動向**:
   - プライム市場: 上昇/下落各上位3セクター（騰落率、小数点第2位、主因を1-2文で事実ベース、影響例: 時価総額変動率）。
   - スタンダード/グロース: 特徴的な動き1-2件（例: 特定セクターの上昇要因、資金流入データ）。
   - 出典URLを各セクター記述後にインライン記載。横の広さ: 市場間比較の1文追加。

3. **注目ニュース（トップ3）**: 今日の企業決算/政策発表/海外影響に限定。1次情報中心で、各ニュースを箇点で詳細記述（影響度を事実で示す: 株価変動率やセクター寄与度）。[TDnet: URL]形式で1次ソースを明記、2次は補完。縦の深さ: 各ニュースに「市場への波及例」1文。

4. **全体トレンド**: 上昇/下落の主因（為替、海外市場、政策等、クロスソース検証）。売買代金の活況度（前日比）、値上がり銘柄比率（%）。明日以降の注目点（事実ベースのみ、憶測禁止）。縦の深さ: 主因を箇点分解+ボラティリティデータ追加。

5. **日米主要指標発表予定（翌営業日焦点）**:
   - 日本: 発表時刻、指標名、予想値、前回値（例: マネーストック、8:50、+2.5%、+2.8%）。
   - 米国: 同上、特に雇用統計（21:30、非農業部門雇用+18万人、+25.4万人）、GDP/ISM等重要指標。
   - 各指標に市場影響を1文で簡潔に（例: 「雇用統計弱含みなら円高圧力」）。出典URLを箇点後に記載。横の広さ: 2-3指標追加。

## 出力フォーマット
- タイトル: 「{latest_trading_day} 国内株式市場サマリー」
- Markdownテーブルで指数をまとめ（セクターはテーブル外の箇点リストで拡張）。
- 箇点でニュース、トレンド、指標予定を記述（読みやすさ優先、各セクションにサブヘッド）。
- 全引用に[ソース名: URL]をインライン記載（可能な限り）。数値は小数点第2位まで。
- データ不足時は「[確認中]」と明記し、推測禁止。全体を客観的に保ち、バイアス/感情表現なし。バランス: 縦（詳細文脈追加）×横（項目網羅+比較）で調整。

## 禁止事項
- 政治的バイアス、感情表現（「好調」「懸念」等主観語避け、事実記述）。
- 根拠のない予測（「急騰するだろう」等）。
- 低精度ソースの引用。ツール使用時は1次情報優先でクロス検証結果のみ採用。
"""


def get_prompt_metadata() -> dict[str, Any]:
    """
    プロンプトのメタデータを返す

    Returns:
        dict: バージョン情報、作成日、説明などのメタデータ
    """
    return {
        "version": "1.0",
        "created_date": "2025-10-31",
        "prompt_type": "market_summary",
        "target_audience": "一般投資家・トレーダー",
        "expected_length": "1000-1500文字",
        "output_format": "Markdown",
        "data_sources": {
            "primary": ["東証公式（jpx.co.jp）", "TDnet企業IR"],
            "secondary": ["日経新聞", "Bloomberg", "Reuters", "Yahoo!ファイナンス"],
            "excluded": ["SNS", "匿名ブログ", "未確認情報"]
        },
        "coverage": {
            "indices": ["日経平均", "TOPIX", "TOPIX-Prime", "TOPIX-Standard", "TOPIX-Growth"],
            "markets": ["東証プライム", "東証スタンダード", "東証グロース"],
            "sections": ["主要指数", "セクター動向", "注目ニュース", "全体トレンド", "日米指標予定"]
        },
        "update_frequency": "営業日毎（大引け後16:00配信）",
        "quality_requirements": {
            "objectivity": "事実ベースのみ、推測・感情表現禁止",
            "accuracy": "1次情報優先、クロス検証必須",
            "precision": "数値は小数点第2位まで",
            "citation": "全データに出典URL明記"
        }
    }
